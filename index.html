<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ImgUL-The Ultimate IMGHOST</title>
  <link href="https://fonts.googleapis.com/css2?family=New+Rocker&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Light theme overrides */
    body.light-theme {
      background: linear-gradient(to bottom right, #f3f4f6, #e5e7eb);
      color: #111827;
    }
    body.light-theme .bg-gray-900\/60 { background-color: rgba(243, 244, 246, 0.6); }
    body.light-theme .text-gray-200 { color: #1f2937; }
    body.light-theme .text-gray-400 { color: #4b5563; }
    body.light-theme .border-gray-700 { border-color: #d1d5db; }
  </style>
</head>
<script>
function updateVisitorCount() {
  fetch('/counter')
    .then(res => res.json())
    .then(data => {
      const totalElem = document.getElementById('totalViews');
      const uniqueElem = document.getElementById('uniqueViews');
      if (totalElem && uniqueElem) {
        totalElem.innerText = data.total;
        uniqueElem.innerText = data.unique;
      }
    })
    .catch(err => console.error('Visitor count error:', err));
}

// Run once on page load
window.addEventListener('DOMContentLoaded', updateVisitorCount);

</script>

<body class="min-h-screen bg-gradient-to-br from-black via-gray-900 to-black text-white dark-theme">

  <!-- Header -->
  <header class="flex justify-between items-center p-6">
    <div class="flex items-center space-x-2">
      <div class="w-8 h-8 bg-gradient-to-r from-pink-500 to-purple-500"></div>
      <span class="text-xl font-bold">ImgUL</span>
    </div>
    <div class="flex space-x-2">
      <button id="text" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 transition">
        Text
      </button>
      <button id="themeToggle" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 transition">
        Theme
      </button>
      <button class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:opacity-90 transition">
        Sign In
      </button>
    </div>
  </header>

  <script>
  const button = document.getElementById('text');

  button.addEventListener('click', () => {
    // Change this URL to the page you want to redirect to
    window.location.href = '/text.html';
  });
</script>

  <!-- Hero Section -->
  <section class="flex flex-col items-center text-center py-16 px-6">
    <h1 class="text-4xl md:text-7xl font-extrabold bg-gradient-to-r from-blue-400 to-pink-500 bg-clip-text text-transparent"
        style="font-family: 'New Rocker', Courier, monospace;">
      Ultimate free imgHOST
    </h1>
  </section>

  <!-- File Upload Section -->
  <section class="flex flex-col items-center px-6 pb-20">
    <div id="dropArea" class="w-full max-w-2xl p-8 border-2 border-dashed border-purple-500/40 bg-gray-900/60 text-center cursor-pointer hover:border-purple-400 transition">
      <input type="file" multiple class="hidden" id="fileUpload" />
      <label for="fileUpload" class="block">
        <p class="text-xl font-semibold text-purple-400">Drag & Drop your files here</p>
        <p class="text-gray-400 mt-2">or click to select files</p>
      </label>
    </div>




    <!-- File List with Preview and Progress -->
    <div id="fileList" class="mt-6 w-full max-w-2xl space-y-3"></div>

    <!-- Upload Button -->
    <button
      id="uploadBtn"
      class="hidden mt-6 px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-500 font-semibold hover:opacity-90 transition disabled:opacity-50">
      Upload Files
    </button>

    <!-- Clear and Copy All Buttons -->
    <div class="mt-4 flex space-x-4">
      <button id="clearAllBtn" class="px-4 py-2 bg-[#62A3F8] hover:bg-[#9E7DD0] transition text-black">
        Clear All
      </button>
      <button id="copyAllBtn" class="px-4 py-2 bg-[#E74C9D] hover:bg-[#B76CBE] transition text-[#1e1e3a]">
        Copy All Links
      </button>
    </div>

    <!-- Uploaded Files Cards -->
    <div id="uploadedFiles" class="mt-6 w-full max-w-2xl grid grid-cols-1 md:grid-cols-2 gap-4"></div>
  </section>

  <!-- Features Section -->
  <section class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto px-6 pb-20">
    <div class="p-6 bg-gray-900/60 border border-gray-700 shadow-lg hover:shadow-purple-500/40 transform transition-transform hover:scale-105">
      <h3 class="text-xl font-semibold text-purple-400">Unlimited Storage</h3>
      <p class="mt-2 text-gray-400">Store images of any size with no limits.</p>
    </div>
    <div class="p-6 bg-gray-900/60 border border-gray-700 shadow-lg hover:shadow-purple-500/40 transform transition-transform hover:scale-105">
      <h3 class="text-xl font-semibold text-purple-400">Lightning Fast</h3>
      <p class="mt-2 text-gray-400">Experience rapid upload & download speeds.</p>
    </div>
    <div class="p-6 bg-gray-900/60 border border-gray-700 shadow-lg hover:shadow-purple-500/40 transform transition-transform hover:scale-105">
      <h3 class="text-xl font-semibold text-purple-400">Secure Transfers</h3>
      <p class="mt-2 text-gray-400">End-to-end encryption for all Images.</p>
    </div>
  </section>

  <!-- Visitor Counter Card -->
<section class="max-w-6xl mx-auto px-6 pb-6">
  <div class="flex justify-center space-x-10 bg-gray-900/50 backdrop-blur-md py-3 px-6 shadow-md text-white text-sm font-medium shadow-lg hover:shadow-purple-500/40 transform transition-transform ">
    <div class="flex items-center space-x-2">
      <span class="text-gray-400">Total Views:</span>
      <span id="totalViews" class="text-purple-400 font-bold">0</span>
    </div>
    <div class="flex items-center space-x-2">
      <span class="text-gray-400">Unique Views:</span>
      <span id="uniqueViews" class="text-pink-400 font-bold">0</span>
    </div>
  </div>
</section>


<script>
// Keep track of previous counts
let prevTotal = 0;
let prevUnique = 0;

// Function to show glow effect
function glowCard() {
  const card = document.getElementById('visitorCard');
  card.classList.add('ring-4', 'ring-green-400');
  setTimeout(() => card.classList.remove('ring-4', 'ring-green-400'), 1000);
}

// Function to show tiny confetti
function confetti() {
  for (let i = 0; i < 20; i++) {
    const conf = document.createElement('div');
    conf.className = 'absolute w-1 h-1 bg-yellow-400 rounded-full animate-fall';
    conf.style.left = Math.random() * window.innerWidth + 'px';
    conf.style.top = '-10px';
    document.body.appendChild(conf);
    setTimeout(() => conf.remove(), 1500);
  }
}

// Update visitor counts
function updateVisitorCount() {
  fetch('/counter')
    .then(res => res.json())
    .then(data => {
      // Trigger effect if unique visitor count increased
      if (data.unique > prevUnique) {
        glowCard();
        confetti();
      }

      document.getElementById('totalViews').innerText = data.total;
      document.getElementById('uniqueViews').innerText = data.unique;

      prevTotal = data.total;
      prevUnique = data.unique;
    });
}

// Initial fetch
updateVisitorCount();

// Auto-update every 10 seconds
</script>

<style>
/* Tiny confetti falling animation */
@keyframes fall {
  0% { transform: translateY(0) rotate(0deg); opacity: 1; }
  100% { transform: translateY(150px) rotate(360deg); opacity: 0; }
}
.animate-fall {
  animation: fall 1.5s ease-out forwards;
}
</style>


  <!-- JavaScript -->
  <script>
    const fileInput = document.getElementById("fileUpload");
    const fileList = document.getElementById("fileList");
    const uploadBtn = document.getElementById("uploadBtn");
    const dropArea = document.getElementById("dropArea");
    const uploadedFilesDiv = document.getElementById("uploadedFiles");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const copyAllBtn = document.getElementById("copyAllBtn");
    const themeToggle = document.getElementById("themeToggle");

    const MAX_SIZE = 10 * 1024 * 1024; // 10MB
    const ALLOWED_TYPES = ['image/jpeg','image/png','image/gif','image/webp'];
    const WEBSITE_URL = "/i/"; // Full URL prefix for copy
    let selectedFiles = [];

    function updateFileList() {
      fileList.innerHTML = "";
      selectedFiles.forEach((file, index) => {
        const div = document.createElement("div");
        div.className = "flex items-center p-4 bg-gray-800/80 border border-gray-700 shadow-md space-x-4 transform transition-transform hover:scale-105";

        const img = document.createElement("img");
        img.className = "w-16 h-16 object-cover";
        img.src = URL.createObjectURL(file);

        const info = document.createElement("div");
        info.className = "flex-1 min-w-0";
        info.innerHTML = `<p class="text-gray-200 truncate max-w-[70%]">${file.name}</p>
                          <div class="w-full bg-gray-700 h-2  mt-1">
                            <div class="h-2 bg-purple-500" id="progress-${index}" style="width:0%"></div>
                          </div>`;

        const removeBtn = document.createElement("button");
        removeBtn.innerText = "Remove";
        removeBtn.className = "text-[#b76cbe] hover:text-[#e74c9d] flex-shrink-0";
        removeBtn.onclick = () => {
          selectedFiles.splice(index, 1);
          updateFileList();
          uploadBtn.classList.toggle("hidden", selectedFiles.length === 0);
        };

        div.appendChild(img);
        div.appendChild(info);
        div.appendChild(removeBtn);
        fileList.appendChild(div);
      });
    }

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        if (!ALLOWED_TYPES.includes(file.type)) {
          alert(`${file.name} is not an allowed image type.`);
          return;
        }
        if (file.size > MAX_SIZE) {
          alert(`${file.name} exceeds maximum size of 10MB.`);
          return;
        }
        selectedFiles.push(file);
      });
      updateFileList();
      uploadBtn.classList.toggle("hidden", selectedFiles.length === 0);
    }

    fileInput.addEventListener("change", (e) => handleFiles(e.target.files));
    dropArea.addEventListener("dragover", (e) => { e.preventDefault(); dropArea.classList.add("border-purple-400"); });
    dropArea.addEventListener("dragleave", () => dropArea.classList.remove("border-purple-400"));
    dropArea.addEventListener("drop", (e) => { e.preventDefault(); dropArea.classList.remove("border-purple-400"); handleFiles(e.dataTransfer.files); });

    // Clear all uploaded cards
    clearAllBtn.onclick = () => uploadedFilesDiv.innerHTML = "";

    // Copy all uploaded links
    copyAllBtn.onclick = () => {
      const links = Array.from(uploadedFilesDiv.querySelectorAll("a"))
                         .map(a => a.href)
                         .join("\n");
      if (links.length > 0) {
        navigator.clipboard.writeText(links);
        alert("All links copied to clipboard!");
      } else {
        alert("No uploaded files to copy.");
      }
    };

    // Theme toggle
    themeToggle.onclick = () => {
      document.body.classList.toggle("light-theme");
      document.body.classList.toggle("dark-theme");
    };

    uploadBtn.addEventListener("click", () => {
      if (selectedFiles.length === 0) return;
      uploadBtn.innerText = "Uploading...";
      uploadBtn.disabled = true;

      const formData = new FormData();
      selectedFiles.forEach(file => formData.append("files[]", file));

      const totalSize = selectedFiles.reduce((sum, f) => sum + f.size, 0);
      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/upload");

      xhr.upload.onprogress = (e) => {
        if (e.lengthComputable) {
          let loaded = e.loaded;
          selectedFiles.forEach((file, index) => {
            const bar = document.getElementById(`progress-${index}`);
            const filePortion = file.size / totalSize;
            const fileProgress = Math.min((loaded / totalSize) / filePortion * 100, 100);
            if (bar) bar.style.width = fileProgress + "%";
            loaded -= file.size;
          });
        }
      };

      xhr.onload = () => {
        const result = JSON.parse(xhr.responseText);
        if (result.files && result.files.length > 0) {
          result.files.forEach((fileData) => {
            if (fileData.status === "success") {
              const fileCard = document.createElement("div");
              fileCard.className = "p-4 bg-gray-900/60 border border-gray-700 shadow-md flex items-center transform transition-transform hover:scale-105";

              const thumb = document.createElement("img");
              thumb.src = WEBSITE_URL + fileData.url;
              thumb.className = "w-16 h-16 object-cover mr-4 flex-shrink-0";

              const info = document.createElement("div");
              info.className = "flex-1 min-w-0";
              info.innerHTML = `
                <p class="text-gray-200 truncate">${fileData.file}</p>
                <a href="${WEBSITE_URL + fileData.url}" target="_blank" class="text-blue-400 underline truncate block">View</a>
              `;

              const copyBtn = document.createElement("button");
              copyBtn.innerText = "Copy";
              copyBtn.className = "ml-4 flex-shrink-0 text-purple-400 hover:text-purple-600";
              copyBtn.onclick = () => {
              const fullURL = window.location.origin + WEBSITE_URL + fileData.url;
              navigator.clipboard.writeText(fullURL);
              alert(`${fileData.file} link copied!`);
              };

              fileCard.appendChild(thumb);
              fileCard.appendChild(info);
              fileCard.appendChild(copyBtn);
              uploadedFilesDiv.appendChild(fileCard);

              // Auto-copy the link after upload
              navigator.clipboard.writeText(
                window.location.origin + WEBSITE_URL + fileData.url
              );
            } else {
              alert(fileData.reason || "Upload failed for " + fileData.file);
            }
          });
        }

        selectedFiles = [];
        uploadBtn.innerText = "Upload Files";
        uploadBtn.disabled = false;
        fileInput.value = "";
        fileList.innerHTML = "";
      };

      xhr.send(formData);
    });
  </script>

</body>
</html>
